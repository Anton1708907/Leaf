<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>GPU Market –Ω–∞ Solana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="fw-bold">üîó GPU Market</h1>
      <p class="text-muted">–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è GPU —á–µ—Ä–µ–∑ Phantom</p>
    </div>

    <div class="card shadow-sm p-4">
      <div class="mb-3 d-flex justify-content-between align-items-center flex-wrap gap-2">
        <select id="network" class="form-select w-auto">
          <option value="devnet">Devnet</option>
          <option value="mainnet-beta">Mainnet</option>
        </select>
        <div>
          <button id="connect" class="btn btn-primary">üîê –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ Phantom</button>
          <button id="register" class="btn btn-success">‚öôÔ∏è –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ GPU</button>
        </div>
      </div>

      <div id="info">
        <p class="text-muted">Phantom –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ</p>
      </div>

      <div class="mt-4">
        <h5>üõ†Ô∏è –õ–æ–≥:</h5>
        <ul id="log" class="list-group small"></ul>
      </div>
    </div>
  </div>

  <script>
    let walletAddress = "";
    const logList = document.getElementById("log");

    function logStep(msg) {
      console.log(msg);
      const li = document.createElement("li");
      li.className = "list-group-item";
      li.textContent = msg;
      logList.appendChild(li);
    }

    function clearLog() {
      logList.innerHTML = "";
    }

    function getGPUInfo() {
      const canvas = document.createElement('canvas');
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      if (!gl) return "–ù–µ–≤—ñ–¥–æ–º–æ";

      const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
      if (debugInfo) {
        return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
      }
      return "–ù–µ–≤—ñ–¥–æ–º–æ";
    }

    document.getElementById("connect").onclick = async () => {
      clearLog();
      logStep("üîå –°–ø—Ä–æ–±–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Phantom...");
      if (window.solana && window.solana.isPhantom) {
        try {
          const res = await window.solana.connect();
          walletAddress = res.publicKey.toString();
          logStep("‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ: " + walletAddress);
          document.getElementById("info").innerHTML = `<p><strong>üíº –ê–¥—Ä–µ—Å–∞:</strong> ${walletAddress}</p>`;
        } catch (err) {
          logStep("‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: " + err.message);
        }
      } else {
        logStep("üö´ Phantom –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ");
        alert("–í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Phantom Wallet: https://phantom.app/");
      }
    };

    document.getElementById("register").onclick = async () => {
      if (!walletAddress) return alert("–°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á–∏ –≥–∞–º–∞–Ω–µ—Ü—å");

      clearLog();
      const specs = getGPUInfo();

      logStep("üì° GPU –≤–∏—è–≤–ª–µ–Ω–æ: " + specs);
      logStep("üì¶ –ù–∞–¥—Å–∏–ª–∞—î–º–æ –Ω–∞ –±–µ–∫–µ–Ω–¥...");

      try {
        const res = await fetch("http://localhost:3000/register-gpu", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ specs })
        });

        const data = await res.json();

        if (data.error) {
          logStep("‚ùå –ü–æ–º–∏–ª–∫–∞: " + data.error);
        } else {
          logStep("‚úÖ GPU –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ!");
          logStep("üÜî GPU –∞–∫–∞—É–Ω—Ç: " + data.gpuAddress);
          document.getElementById("info").innerHTML += `
            <p><strong>üÜî GPU –∞–∫–∞—É–Ω—Ç:</strong> ${data.gpuAddress}</p>`;
        }
      } catch (err) {
        logStep("‚ùå –°–∏—Å—Ç–µ–º–Ω–∞ –ø–æ–º–∏–ª–∫–∞: " + err.message);
      }
    };
  </script>
</body>
</html>
