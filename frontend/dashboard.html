<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="text-center mb-4">
      <h1 class="fw-bold">üë§ –û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
      <p class="text-muted">–¢—É—Ç —Ç–∏ –º–æ–∂–µ—à –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ —Å–≤—ñ–π GPU</p>
    </div>

    <div class="card p-4 shadow-sm">
      <p><strong>üíº –ê–¥—Ä–µ—Å–∞ –≥–∞–º–∞–Ω—Ü—è:</strong> <span id="wallet">–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span></p>
      <p><strong>üîß GPU:</strong> <span id="gpu">–Ω–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ</span></p>
      <button id="registerBtn" class="btn btn-success">üì¶ –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ GPU</button>
    </div>
  </div>

  <script>
    const token = localStorage.getItem("jwt");
    const walletSpan = document.getElementById("wallet");
    const gpuSpan = document.getElementById("gpu");
    const registerBtn = document.getElementById("registerBtn");

    if (!token) {
      alert("‚õî –í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ...");
      window.location.href = "auth.html";
    }

    // –ó–∞–ø–∏—Ç /auth/me
    fetch("http://localhost:3000/auth/me", {
      headers: {
        Authorization: "Bearer " + token,
      },
    })
    .then((res) => res.json())
    .then((data) => {
      if (data.wallet) {
        walletSpan.textContent = data.wallet;
      } else {
        alert("‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –≤—Ç—Ä–∞—á–µ–Ω–æ. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ...");
        window.location.href = "auth.html";
      }
    })
    .catch(() => {
      alert("‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è.");
      window.location.href = "auth.html";
    });

    // –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∫–Ω–æ–ø–∫—É
    registerBtn.onclick = () => {
      gpuSpan.textContent = "‚è≥ –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è...";
      const fakeSpecs = "NVIDIA RTX 4090 (–∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ)";

      fetch("http://localhost:3000/register-gpu", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token,
        },
        body: JSON.stringify({ specs: fakeSpecs }),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.gpuAddress) {
            gpuSpan.textContent = "‚úÖ –ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ: " + data.gpuAddress;
          } else {
            gpuSpan.textContent = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + data.error;
          }
        })
        .catch(() => {
          gpuSpan.textContent = "‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ";
        });
    };
  </script>
</body>
</html>
